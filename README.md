# Hako View

**Hako View** は、ASCII ベースのボクセルファイルを VS Code 内で高速に 3D 可視化する拡張機能です。GPU ベースのレイマーチングシェーダーにより、最大 1024³ のボクセルモデルをシームレスに表示できます。

## 🌟 機能

- **カスタムエディタで開く** - ファイルエクスプローラーから直接ボクセルファイルを 3D ビューアーで表示
- **テキストエディタから切り替え** - コマンドでファイルをテキストエディタから 3D ビューに変更
- **ドラッグ & ドロップ読み込み** - コマンドパレットから空のビューアーを開き、ファイルを D&D で読み込み
- **高速 GPU レンダリング** - 最大 1024³ のボクセルモデルを効率的に表示
- **インタラクティブ操作** - マウスでの回転・ズーム、リアルタイム表示

## 📋 必要環境

- **VS Code**: 1.109.0 以上
- **WebGL2**: GPU レンダリング対応の環境（WebGL2 が利用可能なブラウザ対応 GPU）

## 🚀 インストール

最新のリリース版を [GitHub Release](https://github.com/gen4438/HakoView/releases) からダウンロードしてインストールできます。

1. リリースページから VSIX ファイルをダウンロード
2. VS Code で **Ctrl+Shift+X** / **Cmd+Shift+X** を押して拡張機能パネルを開く
3. 「**...**」メニュー → 「**VSIX からインストール...**」を選択
4. ダウンロードした VSIX ファイルを選択

**開発者向け:** ローカルビルド手順は [CLAUDE.md](CLAUDE.md) を参照してください。

## 📖 使い方

### 方法 1: ファイルエクスプローラーから開く

1. VS Code のエクスプローラーで対応するボクセルファイル（`.leS`）をクリック (インストール時に `.leS` ファイルが自動的に関連付けられます)

### 方法 2: テキストエディタから切り替え

1. ボクセルファイルをテキスト表示で開く
2. コマンドパレット（**Ctrl+Shift+P**）から「Hakoview: Open in Voxel Viewer」を実行、またはエディタ上部の箱アイコンをクリック

### 方法 3: ドラッグ & ドロップで読み込み

1. コマンドパレット（**Ctrl+Shift+P**）から「Hakoview: Open Voxel Viewer」を実行
2. 空のビューアーにボクセルファイルをドラッグ & ドロップ (VS Codeの仕様により、エクスプローラーからD&DするときはShiftキーを押しながら行う必要があります)

## 📄 対応ファイル形式

現在対応している ASCII ベースのボクセルファイル形式（.leS）です。詳細な仕様は [specs/001-les-voxel-viewer/les-format-spec.md](specs/001-les-voxel-viewer/les-format-spec.md) を参照してください。

## ⌨️ キーボードショートカット

### ビュー操作

| キー          | 機能                                                   |
| ------------- | ------------------------------------------------------ |
| `x`, `y`, `z` | 各軸視点に切り替え（繰り返し押すと正負の方向をトグル） |
| `X`, `Y`, `Z` | 各軸周りに90度回転                                     |
| `p`           | パースペクティブ/正投影の切り替え                      |
| `r`           | カメラのみリセット                                     |
| `R`           | 全設定をデフォルト値にリセット                         |

### 表示切り替え

| キー | 機能                                |
| ---- | ----------------------------------- |
| `e`  | エッジハイライトのオン/オフ         |
| `b`  | バウンディングボックスの表示/非表示 |
| `w`  | グリッドの表示/非表示               |

### クリッピング操作

| キー          | 機能                                                                       |
| ------------- | -------------------------------------------------------------------------- |
| `c`           | クリッピングのオン/オフ（Off ↔ Slice）                                     |
| `o`           | スライス1/2の切り替え（Sliceモード時）                                     |
| `k`           | 対象スライスを正方向に移動（数値プレフィックス可、例: `10k`）              |
| `j`           | 対象スライスを負方向に移動（数値プレフィックス可、例: `5j`）               |
| `K`           | 両スライスを正方向に移動（数値プレフィックス可）                           |
| `J`           | 両スライスを負方向に移動（数値プレフィックス可）                           |
| `g`           | 数値プレフィックスありで対象スライスを指定位置にジャンプ（例: `100g`）     |
| `gg`          | 両スライスを距離保持で+側がmaxになるように移動                             |
| `G`           | 数値なしで両スライスを距離保持で-側がminに、数値ありで中心を指定位置に移動 |
| `M`           | 対象スライスを中央に移動                                                   |
| `H`           | 対象スライスを最大位置に移動                                               |
| `L`           | 対象スライスを最小位置に移動                                               |
| `=`           | 両スライスをリセット                                                       |
| `s` → `x/y/z` | スライス軸を切り替え（例: `sz`でZ軸に）                                    |

### その他

| キー                                 | 機能                                                                 |
| ------------------------------------ | -------------------------------------------------------------------- |
| `Ctrl+S` (Win/Linux) / `Cmd+S` (Mac) | 画像を保存（前回の設定で）                                           |
| `ESC`                                | 数値バッファをクリア                                                 |
| `0-9`                                | 数値バッファに入力（スライス移動コマンドのプレフィックスとして使用） |
| `Backspace`                          | 数値バッファの最後の文字を削除                                       |

## 💾 画像保存機能

3D ビューを PNG 画像として保存できます。

### 保存方法

- **ショートカット**: `Ctrl+S` (Win/Linux) / `Cmd+S` (Mac) - 前回の設定で即座に保存
- **ボタン**: 左下の「画像を保存」ボタンをクリック
- **設定**: 歯車アイコンをクリックしてサイズ設定モーダルを開く

### サポートされるサイズ

- **現在のビューサイズ**: 現在の画面サイズで保存（ギズモ含む）
- **Full HD**: 1920×1080
- **2K**: 2560×1440
- **4K**: 3840×2160
- **8K**: 7680×4320
- **カスタム**: 1～16384px の範囲で自由に指定

### 保存形式

- **フォーマット**: PNG
- **ファイル名**: `<元ファイル名>_<幅>x<高さ>_<タイムスタンプ>.png`
- **保存先**: 元のファイルと同じディレクトリ（または任意の場所を選択可能）
- **注意**: 「現在のビューサイズ」以外のサイズでは、オフスクリーンレンダリングによりギズモなしの画像が保存されます

## ⚙️ Leva 設定パネル

右上のメニューから詳細な表示設定が可能です。

### メイン設定（右上）

| 設定項目           | 説明                                                                |
| ------------------ | ------------------------------------------------------------------- |
| **Reset**          | 全設定をデフォルト値にリセット                                      |
| **usePerspective** | パースペクティブ投影（true）/正投影（false）の切り替え              |
| **dpr**            | Device Pixel Ratio（0.5～最大DPR、通常3.0）- 高いほど高品質だが重い |
| **alpha**          | ボクセルの透明度（0.0～1.0）                                        |

#### edgeHighlight（折りたたみ可能）

| 設定項目                | 説明                                                   |
| ----------------------- | ------------------------------------------------------ |
| **enableEdgeHighlight** | エッジハイライトのオン/オフ                            |
| **edgeThickness**       | エッジの太さ（0.02～0.15）                             |
| **edgeColor**           | エッジの色                                             |
| **edgeIntensity**       | エッジの強度（0.0～1.0）                               |
| **edgeMaxDistance**     | エッジのフェード距離（50～モデルサイズに応じた最大値） |

#### voxelColors（折りたたみ可能）

| 設定項目                | 説明                               |
| ----------------------- | ---------------------------------- |
| **Copy Colors**         | カラー設定をクリップボードにコピー |
| **Save to Settings**    | カラー設定を VSCode 設定に保存     |
| **Open Settings**       | VSCode 設定を開く                  |
| **visible0～visible15** | 各ボクセル値（0～15）の表示/非表示 |
| **color0～color15**     | 各ボクセル値の色設定               |

#### camera（折りたたみ可能）

| 設定項目 | 説明                      |
| -------- | ------------------------- |
| **fov**  | 視野角（0～180度）        |
| **far**  | 遠クリップ面（500～3000） |

#### lighting（折りたたみ可能）

| 設定項目             | 説明                       |
| -------------------- | -------------------------- |
| **lightIntensity**   | 平行光源の強度（0.0～2.0） |
| **ambientIntensity** | 環境光の強度（0.0～1.0）   |

#### display（折りたたみ可能）

| 設定項目            | 説明                                |
| ------------------- | ----------------------------------- |
| **showScaleBar**    | スケールバーの表示/非表示           |
| **showBoundingBox** | バウンディングボックスの表示/非表示 |
| **showGrid**        | グリッドの表示/非表示               |

### Clipping Controls（独立パネル）

メインメニューの下に表示される独立したパネルで、モデルの断面表示を制御します。

#### clippingMode

| モード     | 説明                                          |
| ---------- | --------------------------------------------- |
| **Off**    | クリッピング無効                              |
| **Slice**  | スライスモード（2つの平行平面でクリッピング） |
| **Custom** | カスタム平面（法線と距離で定義）              |

#### slice（Slice モード時）

| 設定項目                           | 説明                                |
| ---------------------------------- | ----------------------------------- |
| **sliceAxis**                      | スライス軸（X, Y, Z）               |
| **slicePosition1 (Slice 1 - Pos)** | 正方向のスライス位置（0～最大次元） |
| **slicePosition2 (Slice 2 - Neg)** | 負方向のスライス位置（0～最大次元） |

#### custom（Custom モード時）

| 設定項目           | 説明                                  |
| ------------------ | ------------------------------------- |
| **customNormalX**  | クリッピング平面の法線X成分（-1～1）  |
| **customNormalY**  | クリッピング平面の法線Y成分（-1～1）  |
| **customNormalZ**  | クリッピング平面の法線Z成分（-1～1）  |
| **customDistance** | クリッピング平面の距離（-範囲～範囲） |

## 🛠️ 開発者向け情報

このプロジェクトに貢献したい、またはローカルで開発したい方は、以下のドキュメントを参照してください：

| ドキュメント                                               | 内容                                                             |
| ---------------------------------------------------------- | ---------------------------------------------------------------- |
| [CLAUDE.md](CLAUDE.md)                                     | プロジェクト概要、アーキテクチャ、開発セットアップ、ワークフロー |
| [specs/001-les-voxel-viewer/](specs/001-les-voxel-viewer/) | 機能仕様、実装計画、データモデル、API コントラクト               |
| [docs/release-guide.md](docs/release-guide.md)             | リリース・バージョン管理ガイド                                   |

**クイックスタート:**

```bash
# リポジトリをクローン
git clone https://github.com/gen4438/HakoView.git
cd HakoView

# 依存関係をインストール
pnpm install
cd webview && pnpm install && cd ..

# ウォッチモードで開発
pnpm run watch

# F5 キーで拡張機能開発ホストを起動
```

## 📄 ライセンス

このプロジェクトは MIT ライセンス下で公開されています。

---

**問題報告・機能リクエスト**: [GitHub Issues](https://github.com/gen4438/HakoView/issues)
